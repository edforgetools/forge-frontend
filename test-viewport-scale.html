<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Viewport Scale Test</title>
    <style>
      body {
        margin: 0;
        padding: 20px;
        font-family: Arial, sans-serif;
        background: #f0f0f0;
      }
      .container {
        width: 100%;
        height: 500px;
        border: 2px solid #333;
        background: white;
        position: relative;
        overflow: hidden;
      }
      .canvas {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        border: 1px solid #666;
        background: #e0e0e0;
      }
      .letterbox {
        position: absolute;
        background: #333;
      }
      .controls {
        margin: 20px 0;
        display: flex;
        gap: 10px;
        align-items: center;
      }
      button {
        padding: 8px 16px;
        border: 1px solid #ccc;
        background: white;
        cursor: pointer;
      }
      button.active {
        background: #007bff;
        color: white;
      }
      .info {
        margin: 10px 0;
        font-family: monospace;
      }
    </style>
  </head>
  <body>
    <h1>Viewport Scale Test</h1>

    <div class="controls">
      <span>Zoom Presets:</span>
      <button onclick="setZoom(0.5)" id="zoom-0.5">50%</button>
      <button onclick="setZoom(0.75)" id="zoom-0.75">75%</button>
      <button onclick="setZoom(1)" id="zoom-1" class="active">100%</button>
      <button onclick="setZoom(1.5)" id="zoom-1.5">150%</button>
      <button onclick="setZoom(2)" id="zoom-2">200%</button>
      <span>|</span>
      <button onclick="zoomIn()">+</button>
      <button onclick="zoomOut()">-</button>
      <button onclick="resetZoom()">Reset</button>
    </div>

    <div class="info" id="info">
      Container: 800x500, Canvas: 640x360, Zoom: 100%, Scale: 1
    </div>

    <div class="container" id="container">
      <canvas class="canvas" id="canvas" width="640" height="360"></canvas>
    </div>

    <script>
      let currentZoom = 1;
      const container = document.getElementById("container");
      const canvas = document.getElementById("canvas");
      const info = document.getElementById("info");

      function updateViewport() {
        const containerRect = container.getBoundingClientRect();
        const containerWidth = containerRect.width;
        const containerHeight = containerRect.height;

        // 16:9 aspect ratio
        const targetAspectRatio = 16 / 9;
        const containerAspectRatio = containerWidth / containerHeight;

        let canvasWidth, canvasHeight;
        if (containerAspectRatio > targetAspectRatio) {
          // Container is wider - fit to height
          canvasHeight = containerHeight;
          canvasWidth = canvasHeight * targetAspectRatio;
        } else {
          // Container is taller - fit to width
          canvasWidth = containerWidth;
          canvasHeight = canvasWidth / targetAspectRatio;
        }

        // Apply zoom
        const scaledWidth = canvasWidth * currentZoom;
        const scaledHeight = canvasHeight * currentZoom;

        // Calculate letterbox
        const letterboxTop = Math.max(0, (containerHeight - scaledHeight) / 2);
        const letterboxBottom = Math.max(
          0,
          (containerHeight - scaledHeight) / 2
        );
        const letterboxLeft = Math.max(0, (containerWidth - scaledWidth) / 2);
        const letterboxRight = Math.max(0, (containerWidth - scaledWidth) / 2);

        // Update canvas style
        canvas.style.width = `${canvasWidth}px`;
        canvas.style.height = `${canvasHeight}px`;
        canvas.style.transform = `translate(-50%, -50%) scale(${currentZoom})`;

        // Clear existing letterboxes
        const existingLetterboxes = container.querySelectorAll(".letterbox");
        existingLetterboxes.forEach((lb) => lb.remove());

        // Add letterboxes
        if (letterboxTop > 0) {
          const topLetterbox = document.createElement("div");
          topLetterbox.className = "letterbox";
          topLetterbox.style.cssText = `top: 0; left: 0; width: 100%; height: ${letterboxTop}px;`;
          container.appendChild(topLetterbox);
        }

        if (letterboxBottom > 0) {
          const bottomLetterbox = document.createElement("div");
          bottomLetterbox.className = "letterbox";
          bottomLetterbox.style.cssText = `bottom: 0; left: 0; width: 100%; height: ${letterboxBottom}px;`;
          container.appendChild(bottomLetterbox);
        }

        if (letterboxLeft > 0) {
          const leftLetterbox = document.createElement("div");
          leftLetterbox.className = "letterbox";
          leftLetterbox.style.cssText = `top: 0; left: 0; width: ${letterboxLeft}px; height: 100%;`;
          container.appendChild(leftLetterbox);
        }

        if (letterboxRight > 0) {
          const rightLetterbox = document.createElement("div");
          rightLetterbox.className = "letterbox";
          rightLetterbox.style.cssText = `top: 0; right: 0; width: ${letterboxRight}px; height: 100%;`;
          container.appendChild(rightLetterbox);
        }

        // Update info
        info.textContent = `Container: ${Math.round(
          containerWidth
        )}x${Math.round(containerHeight)}, Canvas: ${Math.round(
          canvasWidth
        )}x${Math.round(canvasHeight)}, Zoom: ${Math.round(
          currentZoom * 100
        )}%, Scale: ${currentZoom}`;
      }

      function setZoom(zoom) {
        currentZoom = zoom;
        updateViewport();
        updateActiveButton();
      }

      function zoomIn() {
        setZoom(Math.min(5, currentZoom * 1.2));
      }

      function zoomOut() {
        setZoom(Math.max(0.1, currentZoom / 1.2));
      }

      function resetZoom() {
        setZoom(1);
      }

      function updateActiveButton() {
        document.querySelectorAll(".controls button").forEach((btn) => {
          btn.classList.remove("active");
        });
        const activeBtn = document.getElementById(`zoom-${currentZoom}`);
        if (activeBtn) {
          activeBtn.classList.add("active");
        }
      }

      // Keyboard shortcuts
      document.addEventListener("keydown", (e) => {
        if (e.ctrlKey || e.metaKey) {
          if (e.key === "+" || e.key === "=") {
            e.preventDefault();
            zoomIn();
          } else if (e.key === "-") {
            e.preventDefault();
            zoomOut();
          }
        }
      });

      // Resize observer
      const resizeObserver = new ResizeObserver(() => {
        updateViewport();
      });
      resizeObserver.observe(container);

      // Initial setup
      updateViewport();
    </script>
  </body>
</html>
